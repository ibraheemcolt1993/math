<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#2563eb" />
  <title>math โ ุดูุงุฏุฉ ุฅูุฌุงุฒ</title>

  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/assets/cert/certificate.css" />
</head>

<body>
  <div class="app cert-app">
    <header class="topbar">
      <div class="container topbar-inner">
        <div class="brand">
          <div class="brand-mark" aria-hidden="true"></div>
          <div class="brand-title">
            <b>math</b>
            <span>ุดูุงุฏุฉ ุฅูุฌุงุฒ</span>
          </div>
        </div>

        <a class="btn btn-ghost btn-sm" href="/" aria-label="ุงูุนูุฏุฉ ููุจุทุงูุงุช">ุงูุนูุฏุฉ</a>
      </div>
    </header>

    <main class="container section">
      <div class="cert-shell">
        <!-- Certificate Paper -->
        <section id="certPaper" class="cert-paper" aria-label="ุดูุงุฏุฉ">
          <div class="cert-bg"></div>

          <div class="cert-head">
            <div class="cert-badge" aria-hidden="true">๐</div>
            <div>
              <h1 class="cert-title">ุดูุงุฏุฉ ุฅูุฌุงุฒ</h1>
              <p class="cert-sub">ุชูููุญ ูุฐู ุงูุดูุงุฏุฉ ุชูุฏูุฑูุง ูุฅุชูุงู ุงูุจุทุงูุฉ ุจูุฌุงุญ</p>
            </div>
          </div>

          <div class="cert-body">
            <p class="cert-line">ููุจุงุฑู ููุทุงูุจ/ุฉ</p>
            <div id="certName" class="cert-name">...</div>

            <p class="cert-line">ุฅุชูุงู</p>
            <div id="certCardTitle" class="cert-card">...</div>

            <div class="cert-meta">
              <div class="cert-meta-item">
                <span class="cert-meta-k">ุงูุฃุณุจูุน</span>
                <span id="certWeek" class="cert-meta-v">โ</span>
              </div>
              <div class="cert-meta-item">
                <span class="cert-meta-k">ุงูุชุงุฑูุฎ</span>
                <span id="certDate" class="cert-meta-v">โ</span>
              </div>
              <div class="cert-meta-item">
                <span class="cert-meta-k">ุงูุดุนุจุฉ</span>
                <span id="certClass" class="cert-meta-v">โ</span>
              </div>
            </div>

            <div class="cert-footer">
              <div class="cert-sign">
                <span class="cert-sign-k">ุงููุนูู</span>
                <span class="cert-sign-v">ุงููุนูู ุฅุจุฑุงููู ุฃุญูุฏ</span>
              </div>
              <div class="cert-stamp" aria-hidden="true">
                <div class="cert-stamp-ring"></div>
                <div class="cert-stamp-text">math</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Actions -->
        <section class="cert-actions">
          <button id="btnPrint" class="btn btn-primary btn-lg w-100">ุชุญููู / ุทุจุงุนุฉ</button>
          <button id="btnShare" class="btn btn-outline w-100" disabled>ูุดุงุฑูุฉ ูุงุชุณุงุจ (ูุฑูุจูุง)</button>
          <p class="small center muted">ุงููุตุฏุฑ: ุขุฎุฑ ุฅูุฌุงุฒ ูุญููุธ ูู ุงูุฌูุงุฒ (math:lastCertificate)</p>
        </section>

        <!-- Fallback message -->
        <section id="certEmpty" class="card hidden">
          <div class="card-header">
            <div>
              <h2 class="h2">ูุง ุชูุฌุฏ ุดูุงุฏุฉ ุจุนุฏ</h2>
              <p class="p">ุฃููู ุจุทุงูุฉ ุฃูููุงุ ูุจุนุฏูู ุงุฑุฌุน ูููู.</p>
            </div>
          </div>
          <div class="card-body">
            <a href="/" class="btn btn-primary w-100">ุงุฐูุจ ููุจุทุงูุงุช</a>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    (function () {
      const LS_LAST_CERTIFICATE = 'math:lastCertificate';

      const elPaper = document.getElementById('certPaper');
      const elEmpty = document.getElementById('certEmpty');

      const elName = document.getElementById('certName');
      const elCard = document.getElementById('certCardTitle');
      const elWeek = document.getElementById('certWeek');
      const elDate = document.getElementById('certDate');
      const elClass = document.getElementById('certClass');

      const btnPrint = document.getElementById('btnPrint');
      const btnShare = document.getElementById('btnShare');

      function readPayload() {
        try {
          const raw = localStorage.getItem(LS_LAST_CERTIFICATE);
          return raw ? JSON.parse(raw) : null;
        } catch (e) {
          return null;
        }
      }

      function fmtDate(iso) {
        try {
          const d = new Date(iso);
          if (isNaN(d.getTime())) return 'โ';
          // yyyy-mm-dd
          const y = d.getFullYear();
          const m = String(d.getMonth() + 1).padStart(2, '0');
          const day = String(d.getDate()).padStart(2, '0');
          return `${y}-${m}-${day}`;
        } catch {
          return 'โ';
        }
      }

      const payload = readPayload();

      if (!payload || !payload.fullName) {
        elPaper.classList.add('hidden');
        elEmpty.classList.remove('hidden');
        btnPrint.disabled = true;
        btnShare.disabled = true;
        return;
      }

      elName.textContent = payload.fullName || payload.firstName || 'โ';
      elCard.textContent = payload.cardTitle || 'ุจุทุงูุฉ';
      elWeek.textContent = (payload.week != null) ? String(payload.week) : 'โ';
      elDate.textContent = fmtDate(payload.issuedAt);
      elClass.textContent = payload.class || 'โ';

      btnPrint.addEventListener('click', () => {
        // ุงููุฑุญูุฉ ุงูุญุงููุฉ: ุทุจุงุนุฉ/ุญูุธ PDF ุนุจุฑ ุงููุชุตูุญ
        window.print();
      });

      // placeholder for Phase 2 share
      btnShare.addEventListener('click', () => {});
    })();
  </script>
</body>
</html>
